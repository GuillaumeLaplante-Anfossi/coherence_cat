% !TEX root = ../Coherence.tex

\section{Topological coherence} 
\label{s:polycoherence}

\subsection{Coherence \`a la Van Kampen}

Let $X$ be a regular CW complex, and let $X_k$, $k\geq 0$ denote its $k$-skeleton. 
Let $\mathcal{F}(X)$ be the groupoid with set of objects $X_0$ and morphisms spanned by the following set: for each $x \in X_0$, one identity morphism $\id_x : x \to x$; and for each $1$-cell $\alpha \in X_1$, one morphism $\alpha : x \to y$ oriented according to its attaching map, and one inverse morphism $\alpha^{-1} : y \to x$ in the opposite direction. 
In other words, $\mathcal{F}(X)$ is the free groupoid generated by the $\alpha$-morphisms. 
A \emph{combinatorial path} on $X$ is a morphism in $\mathcal{F}(X)$, that is, a composable sequence of $\alpha$ and $\alpha^{-1}$ morphisms (a \emph{word} in $\alpha$ and $\alpha^{-1}$).
Two combinatorial paths $\gamma, \gamma' \in \mathcal{F}(X)(x,y)$ with the same endpoints are said to be \emph{parallel}.

The attaching map of a $2$-cell $A$ of $X$ defines a morphism $\gamma_A \in \mathcal{F}(X)(x,x)$ for a certain $x \in A_0$, given by the sequence of $1$-cells in its image.  
Two parallel combinatorial paths $\gamma, \gamma'$ are said to be \emph{elementary combinatorially homotopic} if they differ exactly by a relation of the form $\gamma_A = \id_x$, for some $2$-face $A$.
That is, one can rewrite $\gamma$ into $\gamma'$ by replacing some (possibly empty) subword of $\gamma$ with an equivalent subword using the relation $\gamma_A = \id_x$.
More generally, two parallel combinatorial paths are \emph{combinatorially homotopic} if they are related by a sequence of elementary combinatorial homotopies.

%what about the inverses? il faut imposer la relation alpha-1 est inverse de alpha

\begin{thm}
\label{thm:top-coherence}
    Any two parallel combinatorial paths on $X$ are combinatorially homotopic if and only if every path component of $X$ is simply connected.
\end{thm}

\begin{proof}
    Let $\Pi(X)$ denote the fundamental groupoid of $X$, that is the groupoid with objects the vertices of $X$ and morphisms the homotopy classes of paths between them.
    Let $\mathcal{C}(X)$ denote the quotient of the groupoid $\mathcal{F}(X)$ by the relation "being combinatorially homotopic". 
    Then, we have an isomorphism of groupoids \[ \Pi(X) \cong \mathcal{C}(X) \ . \]
    To show this, one can proceed in three steps. 
    First, one shows that the fundamental groupoid $\Pi(X_1)$ of the $1$-skeleton of $X$ is free on the homotopy classes of maps generated by the attaching maps of the $1$-cells, that is, free on the $\alpha$-morphisms \cite[9.1.5]{Brown2006}.
    Thus, one gets $\Pi(X_1) \cong \mathcal{F}(X)$. 
    Second, one shows that the fundamental groupoid $\Pi(X_2)$ of the $2$-skeleton of $X$ is the free groupoid $\Pi(X_1)$ modulo the relations $\gamma_A=1$, for $A$ a $2$-face of $X$ \cite[9.1.6]{Brown2006}. 
    That is, one has $\Pi(X_2) \cong \mathcal{C}(X)$.
    Third, one shows that the inclusion of $X_2$ in $X$ induces an isomorphism of fundamental groupoids $\Pi(X_2) \cong \Pi(X)$ \cite[9.1.7]{Brown2006}, which concludes the proof of the isomorphism $\Pi(X) \cong \mathcal{C}(X)$.
    The theorem then follows, since every path component of $X$ is simply connected if and only if its fundamental groupoid $\Pi(X)$ is trivial.  
\end{proof}

\subsection{Coherence \`a la Morse}

Let $X\subset \R^n$ be a polyhedral complex, and let $\vec v \in \R^n$ be \emph{generic} on the deges of $X$, meaning that for any pair of vertices $x,y \in X$ lying on the same edge of $X$, we have $\langle \vec v , x \rangle \neq \langle \vec v, y\rangle$.  
For any face $F \subset X$ of $X$, there is a unique \emph{source} vertex $\so(F)$ which satisfies $\langle \vec v , \so(F) \rangle = \min \{\langle \vec v , y \rangle \ | \ y \in F \}$, and a unique \emph{sink} vertex $\sk(F)$ defined similarly with $\max$ instead of $\min$.
Similar definitions make sense for any families of faces $X' \subset X$.
In particular, the complex $X$ itself has unique source $\so(X)$ and sink $\sk(X)$. 

Let $H:=\{y \in \R^n \ | \ \langle \vec v , y \rangle = 0\}$ be the linear hyperplane orthogonal to $\vec v$.  
For every vertex $x \in X$, choose $\varepsilon >0$ such that the interval between $\langle \vec v , x \rangle$ and $\langle \vec v , x \rangle + \varepsilon$ does not contain the image of any other vertex. 

\begin{definition}
    The \emph{outgoing link} of a vertex $x \in X$ is the intersection $\mathcal{F} \cap (H+x+\varepsilon \vec v)$ of the family of faces $\mathcal{F}:=\{ F \subset X \ | \ \so(F)=x \}$ with the affine hyperplane $H+x+\varepsilon \vec v$.
    The \emph{incoming link} of a vertex is defined similarly with $\sk(F)$ instead of $\so(F)$, and $-\varepsilon \vec v$ instead of $+ \varepsilon \vec v$. 
\end{definition}

\begin{lemma}
    \label{lemma:outgoing-link}
    Every path component of $X$ is simply connected if and only if for any choice of generic vector $\vec v \in \R^n$, the outgoing link of every vertex is connected. 
\end{lemma}

\begin{proof}
    We consider the case where $X$ has a unique path component; if not the proof can be applied to every path component of $X$ separately. 

    Let $\vec v \in \R^n$ be generic with respect to $X$, and suppose that the outgoing link of every vertex is connected. 
    Since $\vec v$ is generic, it defines a Morse function $\langle \vec v , -\rangle$ on $X$, in the sense of \cite[Definition 2.2]{bestvinaMorseTheoryFiniteness1997} and \cite[Definition 4.1]{grunertPLMorseTheory2019}.
    Like in classical Morse theory, this implies that $X$ is homotopy equivalent to a cell complex whose $k$-cells are in bijection with critical points of $\langle \vec v , -\rangle$ of index $k$ (see \cite[Lemma 2.5]{bestvinaMorseTheoryFiniteness1997} and \cite[Lemma 4.7]{grunertPLMorseTheory2019}).
    These critical points are always vertices \cite[Lemma 2.3]{bestvinaMorseTheoryFiniteness1997}, and they are of index $1$ if and only if their outgoing link is disconnected, homotopy equivalent to the $0$-sphere \cite[Lemma 4.5]{grunertPLMorseTheory2019}.
    Thus, assuming that every outgoing link of $X$ is connected implies that $X$ is homotopy equivalent to a cell complex with trivial $1$-skeleton; therefore it is simply connected \cite[Point (3) of Corollary 2.6]{bestvinaMorseTheoryFiniteness1997}.
    
    In the other way around, supposing that $X$ is simply connected, then for any generic $\vec v$, the function $\langle \vec v , -\rangle$ presents no disconnected outgoing link; otherwise $X$ would be homotopy equivalent to a complex with non-trivial fundamental groupoid. 
\end{proof}

We are now in position to give an "oriented proof" of the fact that any two parallel combinatorial paths on $X$ are combinatorially homotopic if and only if every path component of $X$ is simply connected.

\begin{proof}[Second proof of {\cref{thm:top-coherence}} for polyhedral complexes]
    \label{p:second-proof}
    Once again, we restrict to the case where $X$ has only one path component. 

    First, we prove an oriented version of the statement: every pair of parallel \emph{oriented} paths on $X$ are combinatorially homotopic if and only if $X$ is simply connected.
    Here, given a generic $\vec v \in \R^n$, a combinatorial path $\gamma$ on $X$ is \emph{oriented} if for any pair $(e, f)$ of consective edges in $\gamma$, we have that $\sk(e)=\so(f)$.  
    Using \cref{lemma:outgoing-link}, we will prove the following equivalent statement: for any generic $\vec v$, every pair of parallel oriented paths on $X$ are combinatorially homotopic if and only if the outgoing link of every vertex is connected.

    Suppose that the outgoing link of every vertex is connected. 
    We prove that any two oriented parallel combinatorial paths in $X$ are combinatorially homotopic. 
    Let $\gamma$ and $\gamma'$ be two parallel oriented paths between two vertices $x$ and $y$. 
    We proceed by induction on the maximal length $m$ of an oriented path between $x$ and $y$ in $X$. 
    Without loss of generality, we can suppose that $y=\sk(X)$; if $y\neq\sk(X)$, we can always find an oriented path between $y$ and $\sk(X)$.
    The cases when $m=0$ and $m=1$ are trivial. 
    Suppose that the hypothesis holds up to $m=k-1, k\geq 2$, and consider two paths $\gamma$ and $\gamma'$ for which $m=k$. 
    Let $e$ and $e'$ denote the edges of $\gamma$ and $\gamma'$ that are adjacent to $x$. 
    We examine three cases.
    \begin{enumerate}
        \item If $e=e'$, we can apply the induction hypothesis to $\gamma \setminus e$ and $\gamma' \setminus e'$. 
        \item If $e \neq e'$ and both edges are on the same $2$-face $F$ of $X$, then using the induction hypothesis we have that $\gamma$ and $\gamma'$ are respectively combinatorially homotopic to the paths $\delta$ and $\delta'$ defined as follows: they go from $x=\so(F)$ to $\sk(F)$ by the unique path containing $e$ and $e'$, respectively, and then from $\sk(F)$ to $y$ along the same arbitrary oriented path. 
        Since $\delta$ and $\delta'$ are combinatorially homotopic by definition, the conclusion follows from the transitivity of the combinatorial homotopy equivalence relation. 
        \item Suppose that $e\neq e'$, and that $e$ and $e'$ are \emph{not} on the same $2$-face of $X$. 
        Since the outgoing link of $x$ is connected, there exists a path $\theta$ between $e$ and $e'$ in this link. 
        For every edge $e_i$ of $X$ in the path $\theta$, choose an oriented path $\gamma_i$ in $X$ from $x$ to $y$ going through $e_i$. 
        Now apply Point (2) above to every pair of parallel oriented paths $(\gamma_i, \gamma_{i+1})$ with $e_i$ and $e_{i+1}$ consecutive in $\theta$, and conclude again by transitivity of the combinatorial homotopy equivalence relation. 
    \end{enumerate}

    In the other direction, suppose that every pair of parallel oriented combinatorial paths are combinatorially homotopic. 
    We show that for any vertex $x$, its outgoing link is connected. 
    Indeed, take two edges $e,e'$ of $X$ with source $x$, and consider their extensions to oriented paths $\gamma, \gamma'$ from $x$ to $\sk(X)$. 
    By hypothesis, these two paths are combinatorially homotopic, that is, there is a sequence of parallel oriented paths from $\gamma$ to $\gamma'$. 
    The collection of first edges in each of these paths defines a path between $e$ and $e'$ in the outgoing link of $x$. 
    Thus, this link is connected. 
    This finishes the proof that every pair of parallel oriented paths on $X$ are combinatorially homotopic if and only if $X$ is simply connected.

    To show \cref{thm:top-coherence} for polyhedral complexes, it remains to show that any two parallel combinatorial paths are combinatorially homotopic if and only if for any generic $\vec v$, any two parallel \emph{oriented} combinatorial paths are combinatorially homotopic. 
    The fact that the non-oriented version implies the oriented one is obvious. 
    For the other implication, suppose that the oriented version holds and let $\gamma$ be a (non-oriented) combinatorial path on $X$ between $x$ and $y$.
    For every vertex $z$ along $\gamma$, one can choose an oriented path $\delta_z$ from $z$ to $\sk(X)$. 
    We observe that for any edge $e: z \to z'$ of $\gamma$, the oriented paths $\delta_z$ and $\delta_{z'}e$ are combinatorially homotopic by hypothesis. 
    Going from $x$ to $y$ inductively one edge at a time and using transitivity of the homotopy equivalence relation, one obtains that $\gamma$ is combinatorially homotopic to $\delta_y^{-1}\delta_x$. 
    Taking another combinatorial path $\gamma'$ parallel to $\gamma$, the same argument shows that $\gamma'$ is combinatorial homotopic to $\delta_y^{-1}\delta_x$.
    Thus $\gamma$ and $\gamma'$ are combinatorially homotopic, which completes the proof. 
\end{proof}