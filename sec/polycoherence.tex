% !TEX root = ../Coherence.tex

\section{Topological coherence} 
\label{s:polycoherence}

\subsection{Coherence \`a la Van Kampen}

Let $X$ be a regular CW complex, and let $X_k$, $k\geq 0$ denote its $k$-skeleton. 
Let $\mathcal{F}(X)$ be the groupoid with set of objects $X_0$ and morphisms spanned by the following set: for each $x \in X_0$, one identity morphism $\id_x : x \to x$; and for each $1$-cell $\alpha \in X_1$, one morphism $\alpha : x \to y$ oriented according to its attaching map, and one inverse morphism $\alpha^{-1} : y \to x$ in the opposite direction. 
In other words, $\mathcal{F}(X)$ is the free groupoid generated by the morphisms $\alpha$. 
A \emph{combinatorial path} on $X$ is a morphism in $\mathcal{F}(X)$, that is, a composable sequence of $\alpha$ and $\alpha^{-1}$ morphisms (a \emph{word} in $\alpha$ and $\alpha^{-1}$).
Two combinatorial paths $\gamma, \gamma' \in \mathcal{F}(X)(x,y)$ with the same endpoints are said to be \emph{parallel}.

The attaching map of a $2$-cell $A$ of $X$ defines a morphism $\gamma_A \in \mathcal{F}(X)(x,x)$ for a certain $x \in A_0$, given by the sequence of $1$-cells in its image.  
Two parallel combinatorial paths $\gamma, \gamma'$ are said to be \emph{elementary combinatorially homotopic} if they differ exactly by a relation of the form $\gamma_A = \id_x$, for some $2$-cell $A$.
That is, one can rewrite $\gamma$ into $\gamma'$ by replacing some (possibly empty) subword of $\gamma$ with an equivalent subword using the relation $\gamma_A = \id_x$.
More generally, two parallel combinatorial paths are \emph{combinatorially homotopic} if they are related by a sequence of elementary combinatorial homotopies.

%what about the inverses? il faut imposer la relation alpha-1 est inverse de alpha

\begin{thm}
\label{thm:top-coherence}
    Any two parallel combinatorial paths on $X$ are combinatorially homotopic if and only if every path component of $X$ is simply connected.
\end{thm}

\begin{proof}
    Let $\Pi(X)$ denote the fundamental groupoid of $X$, that is the groupoid with objects the vertices of $X$ and morphisms the homotopy classes of paths between them.
    Let $\mathcal{C}(X)$ denote the quotient of the groupoid $\mathcal{F}(X)$ by the relation ``being combinatorially homotopic". 
    Then, we have an isomorphism of groupoids \[ \Pi(X) \cong \mathcal{C}(X) \ . \]
    To show this, one can proceed in three steps. 
    First, one shows that the fundamental groupoid $\Pi(X_1)$ of the $1$-skeleton of $X$ is free on the homotopy classes of maps generated by the attaching maps of the $1$-cells, that is, free on the $\alpha$-morphisms \cite[9.1.5]{Brown2006}.
    Thus, one gets $\Pi(X_1) \cong \mathcal{F}(X)$. 
    Second, one shows that the fundamental groupoid $\Pi(X_2)$ of the $2$-skeleton of $X$ is the free groupoid $\Pi(X_1)$ modulo the relations $\gamma_A=1$, for $A$ a $2$-cell of $X$ \cite[9.1.6]{Brown2006}. 
    This is done through repeated application of the Seifert--Van Kampen theorem; one then has $\Pi(X_2) \cong \mathcal{C}(X)$.
    Third, one shows that the inclusion of $X_2$ in $X$ induces an isomorphism of fundamental groupoids $\Pi(X_2) \cong \Pi(X)$ \cite[9.1.7]{Brown2006}, which concludes the proof of the isomorphism $\Pi(X) \cong \mathcal{C}(X)$.
    The theorem then follows, since every path component of $X$ is simply connected if and only if its fundamental groupoid $\Pi(X)$ is trivial.  
\end{proof}

\subsection{Coherence \`a la Morse}

Let $X\subset \R^n$ be a polyhedral complex, and let $\vec v \in \R^n$ be \emph{generic} on the edges of $X$, meaning that for any pair of vertices $x,y \in X$ belonging to the same edge of $X$, we have $\langle \vec v , x \rangle \neq \langle \vec v, y\rangle$.  
Such a generic vector $\vec v$ induces a natural orientation on the edges of $X$, directed from the source vertex where the functional $\langle \vec v, - \rangle$ is minimal to the target vertex where it is maximal. 

In general, for any face $F \subset X$ of $X$, there is a unique \emph{source} vertex $\so(F)$ such that all its adjacent edges $e \subset F$ are outgoing, and a unique \emph{sink} vertex $\sk(F)$ whose adjacent edges are all incoming.
When the complex $X$ has a unique \emph{global sink}, a vertex whose adjacent edges $e \subset X$ are all incoming, we will denote it by $\sk(X)$. 

Let $H:=\{y \in \R^n \ | \ \langle \vec v , y \rangle = 0\}$ be the linear hyperplane orthogonal to $\vec v$.  
For every vertex $x \in X$, choose $\varepsilon >0$ such that the interval between $\langle \vec v , x \rangle$ and $\langle \vec v , x \rangle + \varepsilon$ does not contain the image of any other vertex under the ``height" function $\langle \vec v, - \rangle$. 

\begin{definition}
    The \emph{outgoing link} of a vertex $x \in X$ is the intersection $\mathcal{F} \cap (H+x+\varepsilon \vec v)$ of the family of faces $\mathcal{F}:=\{ F \subset X \ | \ \so(F)=x \}$ with the affine hyperplane $H+x+\varepsilon \vec v$. 
\end{definition}

A combinatorial path $\gamma$ on $X$ is \emph{oriented} if for any pair $(e, f)$ of consective edges in $\gamma$, we have that $\sk(e)=\so(f)$.  
When no ambiguity arises, we will omit the adjective ``combinatorial" and say only ``oriented path".
Two parallel oriented paths are said to be \emph{elementary combinatorially homotopic} if they are as non-oriented paths. 
They are \emph{combinatorially homotopic} if they are related by a sequence of elementary combinatorial homotopies between oriented paths. 

The following Lemma and its consequence \cref{p:second-proof} translate into topological terms the proof of \cite[Theorem 3.1]{MacLane63}.

\begin{lemma}
\label{l:oriented}
    Let $X$ be a polyhedral complex, and let $\vec v$ be generic on the edges of $X$. 
    If there is a unique global sink $\sk(X)$, then the outgoing link of every vertex is connected if and only if any two parallel oriented paths on $X$ are combinatorially homotopic.
\end{lemma}

\begin{proof}
    We prove the first implication. 
    Suppose that the outgoing link of every vertex is connected. 
    Let $\gamma$ and $\gamma'$ be two parallel oriented paths between two vertices $x$ and $y$. 
    We prove that they are combinatorially homotopic. 
    We proceed by induction on the maximal length $m$ of an oriented path between $x$ and $y$ in $X$. 
    Without loss of generality, we can suppose that $y=\sk(X)$, since if $y\neq\sk(X)$ we can always find an oriented path between $y$ and $\sk(X)$.
    The cases when $m=0$ and $m=1$ are trivial. 
    Suppose that the hypothesis holds up to $m=k-1, k\geq 2$, and consider two paths $\gamma$ and $\gamma'$ for which $m=k$. 
    Let $e$ and $e'$ denote the edges of $\gamma$ and $\gamma'$ that are adjacent to $x$. 
    We examine three cases.
    \begin{enumerate}
        \item If $e=e'$, we can apply the induction hypothesis to $\gamma \setminus e$ and $\gamma' \setminus e'$. 
        \item If $e \neq e'$ and both edges are on the same $2$-face $F$ of $X$, then using the induction hypothesis we have that $\gamma$ and $\gamma'$ are respectively combinatorially homotopic to the paths $\delta$ and $\delta'$ defined as follows: they go from $x=\so(F)$ to $\sk(F)$ by the unique path containing $e$ and $e'$, respectively, and then from $\sk(F)$ to $y$ along the same arbitrary oriented path. 
        Since $\delta$ and $\delta'$ are combinatorially homotopic by definition, the conclusion follows from the transitivity of the combinatorial homotopy equivalence relation. 
        \item Suppose that $e\neq e'$, and that $e$ and $e'$ are \emph{not} on the same $2$-face of $X$. 
        Since the outgoing link of $x$ is connected, there exists a path $\theta$ between $e$ and $e'$ in this link. 
        For every edge $e_i$ of $X$ in the path $\theta$, choose an oriented path $\gamma_i$ in $X$ from $x$ to $y=\sk(X)$ going through $e_i$. 
        Now apply Point (2) above to every pair of parallel oriented paths $(\gamma_i, \gamma_{i+1})$ with $e_i$ and $e_{i+1}$ consecutive in $\theta$, and conclude again by transitivity of the combinatorial homotopy equivalence relation. 
    \end{enumerate}

    In the other direction, suppose that every pair of parallel oriented combinatorial paths are combinatorially homotopic. 
    We show that for any vertex $x$, its outgoing link is connected. 
    Indeed, take two edges $e,e'$ of $X$ with source $x$, and consider their extensions to oriented paths $\gamma, \gamma'$ from $x$ to $\sk(X)$. 
    By hypothesis, these two paths are combinatorially homotopic, that is, there is a sequence of parallel oriented paths from $\gamma$ to $\gamma'$. 
    The collection of first edges in each of these paths defines a path between $e$ and $e'$ in the outgoing link of $x$. 
    Thus, this link is connected. 
\end{proof}

\begin{thm}
\label{p:second-proof}
    Let $X$ be a polyhedral complex, and let $\vec v$ be generic on the edges of $X$.
    Suppose that 
    \begin{enumerate}[label=\roman*)]
        \item there is a unique sink $\sk(X)$, and
        \item the outgoing link of every vertex is connected.
    \end{enumerate}
    Then, any two parallel combinatorial paths on $X$ are combinatorially homotopic.
\end{thm}

\begin{proof} 
    By \cref{l:oriented}, the conclusion holds for \emph{oriented} paths.  
    Let us show that this implies the non-oriented version.
    Let $\gamma$ be a (non-oriented) combinatorial path on $X$ between $x$ and $y$.
    For every vertex $z$ along $\gamma$, one can choose an oriented path $\delta_z$ from $z$ to $\sk(X)$. 
    We observe that for any edge $e: z \to z'$ of $\gamma$, the oriented paths $\delta_z$ and $\delta_{z'}e$ are combinatorially homotopic by hypothesis. 
    Going from $x$ to $y$ inductively one edge at a time and using transitivity of the homotopy equivalence relation, one obtains that $\gamma$ is combinatorially homotopic to $\delta_y^{-1}\delta_x$. 
    Taking another combinatorial path $\gamma'$ parallel to $\gamma$, the same argument shows that $\gamma'$ is combinatorial homotopic to $\delta_y^{-1}\delta_x$.
    Thus $\gamma$ and $\gamma'$ are combinatorially homotopic, which completes the proof. 
\end{proof}

\begin{rem}
    One can consider the abstract rewriting system defined by $\vec v$ on the vertices of $X$, saying that $x$ can be rewritten into $y$ if and only if there is an oriented path from $x$ to $y$ in $X$. 
    The hypotheses of \cref{p:second-proof} impose that this rewriting system is terminating and confluent \cite[Definition 2.1.3]{baaderTermRewritingAll1998}.
\end{rem}

The class of polyhedral complexes to which \cref{p:second-proof} applies is a strict subclass of simply connected complexes, as the following proposition shows.

\begin{proposition}
    \label{lemma:outgoing-link}
    Let $X$ be a polyhedral complex.
    If there is a generic vector $\vec v \in \R^n$ such that the outgoing link of every vertex is connected, then every path component of $X$ is simply connected.
\end{proposition}

\begin{proof}
    Let $\vec v \in \R^n$ be generic with respect to $X$, and suppose that the outgoing link of every vertex is connected. 
    Since $\vec v$ is generic on edges, it defines a Morse function $\langle \vec v , -\rangle$ on $X$, in the sense of \cite[Definition 2.2]{bestvinaMorseTheoryFiniteness1997}.
    As in classical Morse theory, one can determine the homotopy type of $X$ by considering its successive level sets. 
    For $t \in \R$ denote by $X_t$ the closed subspace of $X$ containing points $x$ such that $\langle x, \vec v \rangle$ is at least $t$.
    Let $x$ be a vertex of $X$ of height $h=\langle x, \vec v \rangle$.
    Observe first that $X_{h+\epsilon}$, for some small $\epsilon>0$, is homotopy equivalent to $X_{h'}$ where $h' > h$ is the next greater height at which there is a vertex.
    That is, the homotopy type of $X$ can only change at vertices  \cite[Lemma 2.3]{bestvinaMorseTheoryFiniteness1997}.
    Then, one proves that $X_h$ is homotopy equivalent to the pushout of $X_{h+\epsilon}$ with the cone over the outgoing link of $x$ along the outgoing link of $x$  \cite[Lemma 2.5]{bestvinaMorseTheoryFiniteness1997}.
    By our assumption, the outgoing link of $x$ is connected, and thus the cone over it is simply connected. 
    Since the pushout of simply connected spaces over a connected space is always simply connected (this is an application of the Seifert--Van Kampen theorem), we obtain by induction that every path component of $X$ is simply connected \cite[Point (3) of Corollary 2.6]{bestvinaMorseTheoryFiniteness1997}.
\end{proof}

The converse of \cref{lemma:outgoing-link} is not true in general: many simply connected polyhedral complexes, as the one represented in \cref{fig:outgoingpoly}, have disconnected outgoing links, for many (sometimes for all) choices of generic orientation vectors. 

\begin{figure}[h!]
\centering
\begin{tikzpicture}
    \node[regular polygon,
    draw,
    regular polygon sides = 8, minimum size = 3cm] (p) at (0,0) {};
    \draw[-] (p.202.5)--(180:4)--(p.157.5);
    \draw[-] (p.157.5)--(135:4)--(p.112.5);
    \draw[-] (p.112.5)--(90:4)--(p.67.5);
    \draw[-] (p.67.5)--(45:4)--(p.22.5);
    \draw[-] (p.22.5)--(0:4)--(p.-22.5);
    \draw[-] (p.-22.5)--(-45:4)--(p.-67.5);
    \draw[-] (p.-67.5)--(-90:4)--(p.-112.5);
    \draw[-] (p.-112.5)--(-135:4)--(p.-157.5);
\end{tikzpicture}
\caption{A simply connected polyhedral complex which admits disconnected outgoing links for every choice of generic vector.}
\label{fig:outgoingpoly}
\end{figure}

This implies that the converse of \cref{p:second-proof} does not hold, and thus that MacLane's original proof is far from reaching the full generality of \cref{thm:top-coherence}.
However, it will be sufficient for our purposes, presented in the next Section, since it applies to any polytope.

\begin{proposition}
\label{prop:polytopes}
    Let $P \subset \R^n$ be a polytope, and let $\vec v \in \R^n$ be generic with respect to $P$. 
    Then, $P$ admits a unique sink $\sk(P)$, and
    the outgoing link of every vertex is connected.
\end{proposition}

\begin{proof}
    The existence and uniqueness of a sink is one of the basic, very useful facts about polytopes, see \cite[Theorem 3.7]{Ziegler95}.
    For the second part, we first observe that the \emph{link} of a vertex $x$ in a polytope, called the \emph{vertex figure} and denoted $P/x$, is itself a polytope of dimension $\dim P -1$, whose $(k-1)$-faces are in bijection with the $k$-faces of $P$ that contain $x$ \cite[Proposition 2.4]{Ziegler95}. 
    Now, the affine hyperplane $H+x$, where $H:=\{y \in \R^n \ | \ \langle \vec v, y \rangle = 0\}$, defines a partition of the vertices of $P/x$ into two connected components: the vertices that correspond to incoming, resp. outgoing, edges of $P$ at $x$.
\end{proof}